<!DOCTYPE html>
<html lang="en" class="wf-firasans-n4-active wf-active">
	<head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Enable responsiveness on mobile devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    
    
    <meta name="generator" content="Hugo 0.42.1" />
    
    <title>Coloreando atractores &middot; Daniel Redondo</title>
    <meta content="Coloreando atractores - Daniel Redondo" property="og:title">
    <meta content=" - " property="og:description">
    <!-- CSS -->
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i|Roboto+Mono:300,300i,400,400i" rel="stylesheet">
    <link rel="stylesheet" href="/css/print.css" media="print">
    <link rel="stylesheet" href="/css/poole.css">
    <link rel="stylesheet" href="/css/hyde.css">
    <!-- Font-Awesome -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/all.js" integrity="sha384-xymdQtn1n3lH2wcu0qhcdaOpQwyoarkgLVxC/wZ5q7h9gHtxICrpcaSUfygqZGOe" crossorigin="anonymous"></script>
    <!-- highlight.js-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <!-- Customised CSS -->
    <link rel="stylesheet" href="/css/custom.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/img/favicon.png">
    

	</head>
    <body class="theme-custom-drs ">
        <div class="sidebar">
  <div class="container text-center ">
    <div class="sidebar-about text-center">
      <a href="/"><h1 class="brand">Daniel Redondo</h1></a>
       <img src="/img/piramide.png" alt="Author Image" class="img-circle headshot center"> 
      <p class="lead">
         danielredondo.com 
      </p>
    </div>
    
<div>
	<ul class="sidebar-nav">
		
		
				<li>
					<a href="/posts/"> <span>BLOG</span></a>
				</li>
				<li>
					<a href="/publicaciones/"> <span>PUBLICACIONES CIENTÍFICAS</span></a>
				</li>
				<li>
					<a href="/aplicaciones/"> <span>APLICACIONES WEB</span></a>
				</li>
				<li>
					<a href="/about/"> <span>SOBRE MÍ</span></a>
				</li>
		</li>
	</ul>
</div>

    <p>
      <section class="row text-center">
	
	<a href="https://twitter.com/dredondosanchez"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	&nbsp;<a href="https://github.com/danielredondo"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
	
	&nbsp;<a href="mailto:danielredondosanchez@hotmail.com"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
	
</section>

    </p>
    <p class="copyright">&copy; 2019 Daniel Redondo.
      <a href="https://creativecommons.org/licenses/by/4.0"><br/>Some Rights Reserved</a>.<br/>Built with <a href="https://github.com/rstudio/blogdown">blogdown</a>, <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
    </p>
  </div>
  <div>
  </div>
</div>

        <div class="content container">
            <div class="post">
  <h1>Coloreando atractores</h1>
  
  <div class="col-sm-12 col-md-12">
    <span class="text-left post-date meta">
            
       
        <i class="fas fa-calendar-alt"></i> Feb 10, 2019
      
      
      
      
      <br/>
      <i class="fas fa-clock"></i> 5 min read 
      </span>  
  </div>    
  
  <p>Hace unas semanas, Antonio Sánchez Chinchón escribía <strong><a href="https://fronkonstin.com/2019/01/10/rcpp-camaron-de-la-isla-and-the-beauty-of-maths/">en su muy recomendable blog</a></strong> sobre las gráficas que forman algunas ecuaciones imposibles de resolver, los atractores que se ven en ellas, y la belleza de las matemáticas.</p>
<p>Todo ello, ilustrado con imágenes tan artísticas como:</p>
<div class="figure">
<img src="\posts\20190210_atractor\imagen.png" />

</div>
<p>Las gráficas me gustaron tanto que quise usarlas de fondo de pantalla. Y aprovechando que Antonio <a href="https://github.com/aschinchon/general-2D-map">dejó el código en su GitHub</a>, pensé en <strong>darles un toque de color, sin salir de R</strong>.</p>
<p>En primer lugar, eliminamos el borde de la imagen, y cambiamos algunas opciones para que la imagen final no salga cuadrada, sino apaisada.</p>
<p>Un ejemplo “en blanco y negro” es el siguiente:</p>
<pre class="r"><code>library(Rcpp)
library(tidyverse)
library(wesanderson)
library(colorspace)

opt &lt;-  theme(legend.position  = &quot;none&quot;,
              panel.background = element_rect(fill = &quot;white&quot;),
              plot.background  = element_rect(fill = &quot;white&quot;),
              axis.ticks       = element_blank(),
              panel.grid       = element_blank(),
              axis.title       = element_blank(),
              axis.text        = element_blank())

cppFunction(&#39;DataFrame createTrajectory(int n, double x0, double y0, 
            double a1,  double a2,  double a3,  double a4,  double a5,  double a6,  double a7,
            double a8,  double a9,  double a10, double a11, double a12, double a13, double a14) {
            // create the columns
            NumericVector x(n);
            NumericVector y(n);
            x[0] = x0;
            y[0] = y0;
            for(int i = 1; i &lt; n; ++i) {
            x[i] = a1 + a2 * x[i-1] + a3  * y[i-1] + a4  * pow(fabs(x[i-1]), a5)  + a6  * pow(fabs(y[i-1]), a7 );
            y[i] = a8 + a9 * x[i-1] + a10 * y[i-1] + a11 * pow(fabs(x[i-1]), a12) + a13 * pow(fabs(y[i-1]), a14);
            }
            // return a new data frame
            return DataFrame::create(_[&quot;x&quot;]= x, _[&quot;y&quot;]= y);
            }
            &#39;)

a1 &lt;- -0.8
a2 &lt;- 0.4
a3 &lt;- -1.1
a4 &lt;- 0.5
a5 &lt;- -0.6
a6 &lt;- -0.1
a7 &lt;- -0.5
a8 &lt;- 0.8
a9 &lt;- 1.0
a10 &lt;- -0.3
a11 &lt;- -0.6
a12 &lt;- -0.3
a13 &lt;- -1.2
a14 &lt;- -0.3

df &lt;- createTrajectory(10000000, 1, 1, a1, a2, a3, a4, a5, a6, 
                       a7, a8, a9, a10, a11, a12, a13, a14)

mx &lt;- quantile(df$x, probs = 0.01)
Mx &lt;- quantile(df$x, probs = 0.99)
my &lt;- quantile(df$y, probs = 0.05)
My &lt;- quantile(df$y, probs = 0.95)

df %&gt;% filter(x &gt; mx, x &lt; Mx, y &gt; my, y &lt; My) -&gt; df

# GRAFICO ORIGINAL
plot &lt;- ggplot(df) +
  geom_point(aes(x, y), shape = 46, alpha = 0.01, size = 0, color = &quot;black&quot;) +
  scale_x_continuous(expand = c(0,0))+
  scale_y_continuous(expand = c(0,0))+
  coord_fixed() + 
  opt

# Al pintar 10.000.000 de puntos, puede tardar un par de minutos.
ggsave(&quot;original.png&quot;, plot, height = 4, width = 8, units = &#39;in&#39;, dpi = 1200)</code></pre>
<div class="figure">
<img src="https://i.imgur.com/kDhBiiU.jpg" />

</div>
<p>Procedemos ahora a colorear el mismo ejemplo, usando la famosa paleta de colores <code>rainbow</code>, y coloreando de forma circular, añadiendo algo de ruido para quitar uniformidad.</p>
<pre class="r"><code>df$s &lt;- (df$x - mean(df$x))^2 + (df$y-mean(df$y))^2 + 4*rnorm(nrow(df))
df &lt;- df[order(df$s), ]

plot &lt;- ggplot(df) +
  geom_point(aes(x, y), shape = 46, alpha = 0.01, size = 0, color = rainbow(nrow(df))) +
  scale_x_continuous(expand = c(0,0))+
  scale_y_continuous(expand = c(0,0))+
  coord_fixed() + 
  opt

ggsave(&quot;rainbow.png&quot;, plot, height = 4, width = 8, units = &#39;in&#39;, dpi = 1200)</code></pre>
<div class="figure">
<img src="https://i.imgur.com/tmLflBp.jpg" />

</div>
<p>También podemos usar el paquete <code>wesanderson</code>, que <a href="https://github.com/karthik/wesanderson">genera paletas de color basándose en las películas de Wes Anderson</a>. La usada en este ejemplo está basada en “El Gran Hotel Budapest”, y la imagen se colorea desde arriba hacia abajo, añadiendo también ruido. He cambiado los parámetros de la función para que la gráfica sea diferente.</p>
<pre class="r"><code>a1 &lt;- -1.0
a2 &lt;- 0.4
a3 &lt;- -1.1
a4 &lt;- 0.5
a5 &lt;- -0.6
a6 &lt;- -0.1
a7 &lt;- -0.5
a8 &lt;- 0.8
a9 &lt;- 1.0
a10 &lt;- -0.3
a11 &lt;- -0.6
a12 &lt;- -0.3
a13 &lt;- -1.2
a14 &lt;- -0.3

df &lt;- createTrajectory(10000000, 1, 1, a1, a2, a3, a4, a5, a6, 
                       a7, a8, a9, a10, a11, a12, a13, a14)

mx &lt;- quantile(df$x, probs = 0.01)
Mx &lt;- quantile(df$x, probs = 0.99)
my &lt;- quantile(df$y, probs = 0.05)
My &lt;- quantile(df$y, probs = 0.95)

df %&gt;% filter(x &gt; mx, x &lt; Mx, y &gt; my, y &lt; My) -&gt; df

df$s &lt;- df$y + rnorm(nrow(df))/5

df &lt;- df[order(df$s), ]

pal &lt;- wes_palette(nrow(df), name = &quot;GrandBudapest1&quot;, type = &quot;continuous&quot;)

plot &lt;- ggplot(df) +
  geom_point(aes(x, y), shape = 46, alpha = 0.01, size = 0, color = pal) +
  scale_x_continuous(expand = c(0,0))+
  scale_y_continuous(expand = c(0,0))+
  coord_fixed() + 
  opt

ggsave(&quot;wes.png&quot;, plot, height = 4, width = 8, units = &#39;in&#39;, dpi = 1200)</code></pre>
<div class="figure">
<img src="https://i.imgur.com/bZVbB3s.jpg" />

</div>
<p>Y para acabar, podemos usar también las paletas del paquete <code>colorspace</code>. Cambiamos los parámetros del dibujo, y la imagen se colorea en diagonal.</p>
<pre class="r"><code>a1 &lt;- -0.8
a2 &lt;- 0.5
a3 &lt;- -0.9
a4 &lt;- 0.4
a5 &lt;- -0.6
a6 &lt;- -0.5
a7 &lt;- -0.2
a8 &lt;- 0.8
a9 &lt;- 1.0
a10 &lt;- -0.3
a11 &lt;- -0.4
a12 &lt;- -0.2
a13 &lt;- -1.2
a14 &lt;- -0.3

df &lt;- createTrajectory(10000000, 1, 1, a1, a2, a3, a4, a5, a6, 
                       a7, a8, a9, a10, a11, a12, a13, a14)

mx &lt;- quantile(df$x, probs = 0.01)
Mx &lt;- quantile(df$x, probs = 0.99)
my &lt;- quantile(df$y, probs = 0.05)
My &lt;- quantile(df$y, probs = 0.95)

df %&gt;% filter(x &gt; mx, x &lt; Mx, y &gt; my, y &lt; My) -&gt; df

df$s &lt;- df$x +  df$y + 4 * rnorm(nrow(df))
df &lt;- df[order(df$s), ]

pal &lt;- sequential_hcl(nrow(df), &quot;Red-Blue&quot;)

plot &lt;- ggplot(df) +
  geom_point(aes(x, y), shape = 46, alpha = 0.01, size = 0, color = pal) +
  scale_x_continuous(expand = c(0,0))+
  scale_y_continuous(expand = c(0,0))+
  coord_fixed() + 
  opt

ggsave(&quot;hcl.png&quot;, plot, height = 4, width = 8, units = &#39;in&#39;, dpi = 1200)</code></pre>
<div class="figure">
<img src="https://i.imgur.com/2F27JHh.jpg" />

</div>
<p>Como suele tardar un poco en guardar el gráfico, he encontrado muy útil esta línea de código, que añadida después del <code>ggsave</code> te avisa con un mensaje de voz cuando ha terminado el proceso. Eso sí, sólo para Mac, ya que usa su terminal (quizá escriba pronto un post con otras opciones para Windows, o multiplataforma).</p>
<pre class="r"><code>system(&quot;say -v Jorge Hola, soy R, y he acabado el gráfico.&quot;)</code></pre>

</div>
            <div class="footer">
                <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>

<script type="text/javascript">
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
</script>

    

            </div>
        </div>
        
        
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-129757599-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    </body>
</html>
